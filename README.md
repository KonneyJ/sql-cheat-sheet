# Шпаргалка по SQL
## Общая информация
Базы данных бывают разными, и различаются они способом хранения информации.

Если данные представлены в виде связанных таблиц, такую базу данных называют **реляционной**. Элементы таблицы РБД имеют специальные названия. 

Столбцы называются **полями**, колонками или признаками, строки - **записями**, объекты на пересечении полей и записей - **ячейками**.

Каждая строка таблицы содержит уникальную информацию. Для этого к каждой записи добавляется специальный признак - **первичный ключ**. Такой ключ не позволит создать абсолютно одинаковые записи. Еще первичный ключ позволяет установить связи между таблицами. Это позволяет делать запросы, которые объединяют записи из нескольких таблиц базы.

## СУБД
Для управления базами данных существует специальное программное обеспечение. Такое ПО называют **система управления базами данных** (database management system, DBMS) или **СУБД**. 

Возможности СУБД:
- создать базу или таблицу в базе
- внести новые данные или удалить устаревшие
- выгрузить нужную информацию, задав условие
- обеспечить безопасный доступ к данным  

Виды СУБД: 
- PostgreSQL
- MySQL
- MongoDB
- Oracle
- Redis и др

## SQL
Реляционными базами данных управляют с помощью языка **SQL** или **Structured Query Language** (язык структурированных запросов). 

SQL - декларативный язык, то есть описывает не алгоритм действий, а данные которые хотят получить. Как выполнить такую команду решает СУБД.  

У SQL также много **диалектов** - наборов дополнительных команд, которые расширяют стандартные возможности языка.

## Структура запросов
Запросы на языке SQL пишут с помощью операторов.   

**SELECT** - оператор, с помощью которого описывают, что нужно выгружать из базы  
**FROM** - оператор, с помощью которого описывают, откуда именно нужно выгружать данные  
**COUNT()** - оператор подсчитывает число записей  
**AS** - оператор после которого пишут псевдоним поля  
**LIMIT** - оператор, который ставят в конце запроса и после него указывают количество записей(строк), которые нужно выгрузить  
**OFFSET** - оператор, который указывает с какой записи начать выборку  
**WHERE** - оператор, после которого указывают условие для выгрузки данных


Чтобы оставлять пометки в коде, в SQL можно использовать комментарии
```sql
-- Так выглядит однострочный комментарий

/* Так
выглядит
многострочный
комментарий*/
```

## Оператор WHERE
Оператор **WHERE** указывают после оператора **FROM** 
```sql
SELECT поле_1, -- поля для выгрузки
       поле_2 
             ...
FROM таблица -- таблица, из которой выгружают данные
WHERE поле > 4; -- условие для среза данных
``` 
Задать условия можно с помощью операторов сравнения. Они выглядят так: 
- '=' - равно
- '!=' - не равно
- '>' - больше
- '<' - меньше
- '>=' - больше или равно
- '<=' - меньше или равно

Если значение сравнивают с символьным типом, набор символов нужно взять в одинарные кавычки:  
 **WHERE поле = 'Иванов'**   
 
 Также это правило касается времени и даты:  
 **WHERE поле = '2013-07-01'**

Поле, по которому формируется условие, необязательно должно присутствовать в **SELECT**

В PostgreSQL в операторе **WHERE** нельзя использовать псевдонимы. Потому что "под капотом" во время компиляции **WHERE** выполняется раньше, чем **SELECT**, когда псевдонимы еще не назначены.

### Логические операторы
В SQL три логических оператора: **AND**, **OR**, **NOT** - и помощник **IN**

**AND** применяют в том случае, если выгружаемые данные должны соответствовать всем перечисленным условиям  

**OR** позволяет отобрать данные, которые удовлетворяют одному из условий  

**NOT** - с его помощью выгружают данные, которые не соответствуют условию  

**IN** работает также, как несколько операторов OR. Достаточно прописать его после нужного поля и в скобках перечислить необходимые значения
```sql
WHERE age > 25 
  AND first_name IN ('Виктор', 'Любовь', 'Борис', 'Станислав', 'Алина', 'Евгения', 'Ольга');
```

### Правила действия логических операторов
Условия, которые объединяются в запросе после **WHERE**, представляют собой утверждения. Каждое утверждение проходит проверку на истинность. 

Если утверждение истинно, получаем значение **TRUE**, либо **FALSE** - если утверждение ложно.

Каждый из логических операторов действует по своим правилам:

- **AND** - возвращает **TRUE**, только если оба логических значения тоже **TRUE**
- **OR** - возвращает **TRUE**, если хотя бы одно из логических значений тоже **TRUE**
- **NOT** - меняет значение на противоположное: **TRUE** на **FALSE**, а **FALSE** на **TRUE**

Условия с разными логическими операторами имеют разный приоритет. Первым всегда выполняется условие с оператором **NOT**, за ним - **AND** и в последнюю очередь - условие с **OR**.

Управлять порядком можно еще с помощью скобок - арифметические операции в скобках выполняются первыми.

## Стиль запросов
**SQL** - язык, не чувствительный к регистру: между операторами SELECT и select нет разницы. Но в SQL есть правила стиля.

### Правило № 1. Выделение ключевых слов
**Первое правило хорошего стиля** - отделять ключевые слова от названий столбцов и таблиц. Ключевые слова пишут в верхнем регистре, а названия - в нижнем.
```sql
SELECT *
FROM pizza;
```
Так запрос писать не стоит.
```sql
Select *
From pizza;
```

### Правило № 2. Перенос строк
**Второе правило хорошего стиля** - перечислять поля и функции, перенося их на новую строку и выстраивая в один столбик. Так проще понять, какие поля или значения будут выгружены.
```sql
SELECT last_name,
       first_name,
       title
FROM staff;
```
Оформить запрос по всем правилам можно вручную или с помощью SQL-форматера, например [SQLFormat](https://sqlformat.org/).